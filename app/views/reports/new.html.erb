<% content_for :meta_title, "Share Your Building Red Tape Story | Red Tape LA" %>
<% content_for :meta_description, "Tell us about your experience with LA's building bureaucracy. Report permit delays, inspection issues, zoning problems, or excessive fees. Takes 5 minutes, helps build the case for reform." %>

<div class="container">
  <header>
    <h1 class="hero-title">Share Your Story</h1>
    <p class="hero-subtitle">
      Tell us about permits, inspections, zoning, fees, or any other bureaucratic
      barrier that delayed your project. Takes less 5 minutes.
    </p>
  </header>
    <!-- Validation Errors -->
    <% if @report.errors.any? %>
      <div class="alert alert-error">
        <h4>Please fix the following:</h4>
        <ul>
          <% @report.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Form Card -->
    <section class="card">
    <%= form_with model: @report, local: true, data: { controller: "form-validation" } do |form| %>

      <!-- SECTION 1: Essential Information -->
      <fieldset>
        <legend class="form-section-header">Your Experience</legend>
        <p class="form-section-description">These details help us understand your situation and verify your report.</p>

        <div class="form-group">
          <%= form.label :email, "Your Email (Required)" %>
          <%= form.email_field :email,
              required: true,
              placeholder: "your@email.com",
              autocomplete: "email",
              data: { form_validation_target: "field" },
              aria: { required: true, describedby: "email_help" } %>
          <div id="email_help" class="help-text">Required for verification. Never shared with officials or publicly.</div>
        </div>


        <div class="form-group">
          <%= form.label :project_type, "What type of project? (Required)" %>
          <%= form.select :project_type,
              Report::PROJECT_TYPES,
              { prompt: "Select your project type" },
              { required: true, data: { form_validation_target: "field" }, aria: { required: true } } %>
        </div>

        <div class="form-group">
          <%= form.label :project_description, "Describe your project (Required, minimum 10 characters)" %>
          <%= form.text_area :project_description,
              required: true,
              rows: 3,
              maxlength: 500,
              placeholder: "Example: Building a backyard ADU for my mother to live in",
              data: { form_validation_target: "field", min_length: 10 },
              aria: { required: true, describedby: "project_desc_help" } %>
          <div id="project_desc_help" class="help-text">Just a brief description - a sentence or two is fine (minimum 10 characters)</div>
        </div>

        <div class="form-group">
          <%= form.label :location, "Where is this project? (Required)" %>
          <%= form.text_field :location,
              required: true,
              placeholder: "Address or general area (e.g., Hollywood, 90042)",
              data: { form_validation_target: "field" },
              aria: { required: true, describedby: "location_help" } %>
          <div id="location_help" class="help-text">Be as general or specific as you're comfortable with</div>
        </div>

        <div class="form-group">
          <%= form.label :issue_description, "What went wrong with the building process? (Required, minimum 20 characters)" %>
          <%= form.text_area :issue_description,
              required: true,
              rows: 6,
              maxlength: 2000,
              placeholder: "Example: Our ADU construction was going smoothly until it was time to connect the power. We've been stalled for four months waiting for LADWP...",
              data: { form_validation_target: "field", min_length: 20 },
              aria: { required: true, describedby: "issue_desc_help" } %>
          <div id="issue_desc_help" class="help-text">Include specific details about delays, unclear requirements, conflicting information, or unexpected costs (minimum 20 characters)</div>
        </div>

        <div class="form-group">
          <%= form.label :timeline_impact, "How long has this delayed your project? (Required)" %>
          <%= form.select :timeline_impact,
              Report::TIMELINE_IMPACTS,
              { prompt: "Select delay timeframe" },
              { required: true, data: { form_validation_target: "field" }, aria: { required: true } } %>
        </div>
      </fieldset>

      <!-- SECTION 2: Optional Details -->
      <fieldset>
        <legend class="form-section-header">Additional Details (Optional)</legend>
        <p class="form-section-description">This helps us identify patterns across reports. Skip anything you don't feel like sharing.</p>

        <fieldset class="form-group">
          <legend>Which issues are you experiencing?</legend>
          <div id="issue_categories_help" class="help-text">Select any that apply.</div>
          <div class="checkbox-grid" role="group" aria-describedby="issue_categories_help">
            <% Report::ISSUE_CATEGORIES.each do |category| %>
              <div class="checkbox-item">
                <%= check_box_tag 'report[issue_categories][]', category,
                    @report.issue_categories.include?(category),
                    id: "report_issue_categories_#{category.parameterize.underscore}" %>
                <%= label_tag "report_issue_categories_#{category.parameterize.underscore}",
                    category, class: "checkbox-label" %>
              </div>
            <% end %>
          </div>
        </fieldset>

        <fieldset class="form-group">
          <legend>Which departments are involved?</legend>
          <div id="departments_help" class="help-text">Select any that apply.</div>
          <div class="checkbox-grid" role="group" aria-describedby="departments_help">
            <% Report::DEPARTMENTS.each do |dept| %>
              <div class="checkbox-item">
                <%= check_box_tag 'report[departments][]', dept,
                    @report.departments.include?(dept),
                    id: "report_departments_#{dept.parameterize.underscore}" %>
                <%= label_tag "report_departments_#{dept.parameterize.underscore}",
                    dept, class: "checkbox-label" %>
              </div>
            <% end %>
          </div>
        </fieldset>
        <div class="form-group">
          <%= form.label :financial_impact, "Financial impact" %>
          <%= form.text_field :financial_impact,
              placeholder: "e.g., $50,000 in extra costs, $2,000/month holding costs, lost income" %>
          <div class="help-text">Estimate additional costs beyond normal permit fees (architect fees, holding costs, lost income, etc.)</div>
        </div>

        <div class="form-group">
          <%= form.label :solution_ideas, "Have ideas for solutions?" %>
          <%= form.text_area :solution_ideas, rows: 4, maxlength: 1000,
              data: { form_validation_target: "field" },
              placeholder: "Example: The city should publish clear requirements upfront about transformer capacity before someone designs their project..." %>
          <div class="help-text">If you have thoughts on specific policy changes that would have helped your situation, we'd love to hear them. But if not, no worries - your story alone is valuable.</div>
        </div>
      </fieldset>

      <!-- Submit Button -->
      <div class="form-actions">
        <%= form.submit "Submit Your Story", class: "btn btn-gold btn-large", data: { disable_with: "Submitting..." } %>
        <p class="privacy-note">
          Your information will be used to advocate for policy changes. All reports are anonymized when shared with officials.
        </p>
      </div>
    <% end %>
    </section>


</div>
