<!-- app/views/reports/new.html.erb -->
<% content_for :title, "Report Your Experience | Red Tape LA" %>
<div class="container">
  <header>
    <h1 class="hero-title">Report Your Experience</h1>
    <p class="hero-subtitle">
      Tell us what went wrong with LA's building processâ€”permits, inspections, zoning, fees, or other issues. Your report takes 5 minutes and helps document systemic problems.
    </p>
  </header>

  <main>
    <!-- Flash Messages -->
    <% if notice %>
      <div class="alert alert-success">
        <h4>Thank you!</h4>
        <p style="margin: 0;"><%= notice %></p>
      </div>
    <% end %>

    <% if @report.errors.any? %>
      <div class="alert alert-error">
        <h4>Please fix the following:</h4>
        <ul>
          <% @report.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Form Card -->
    <section class="card">
    <%= form_with model: @report, local: true do |form| %>

      <!-- SECTION 1: Essential Information -->
      <div class="form-section">
        <h2 class="form-section-header">Your Experience</h2>
        <p class="form-section-description">These details help us understand your situation and verify your report.</p>

        <div class="form-group">
          <%= form.label :email, "Your Email" %>
          <%= form.email_field :email, required: true, placeholder: "your@email.com" %>
          <div class="help-text">Required for verification. Never shared with officials or publicly.</div>
        </div>


        <div class="form-group">
          <%= form.label :project_type, "What type of project?" %>
          <%= form.select :project_type,
              Report::PROJECT_TYPES,
              { prompt: "Select your project type" },
              { required: true } %>
        </div>

        <div class="form-group">
          <%= form.label :project_description, "Describe your project" %>
          <%= form.text_area :project_description, required: true, rows: 3,
              placeholder: "Example: Building a backyard ADU for my mother to live in" %>
          <div class="help-text">Just a brief description - a sentence or two is fine</div>
        </div>

        <div class="form-group">
          <%= form.label :location, "Where is this project?" %>
          <%= form.text_field :location, required: true,
              placeholder: "Address or general area (e.g., Hollywood, 90042)" %>
          <div class="help-text">Be as general or specific as you're comfortable with</div>
        </div>

        <div class="form-group">
          <%= form.label :issue_description, "What went wrong with the building process?" %>
          <%= form.text_area :issue_description, required: true, rows: 6,
              placeholder: "Example: I applied for my garage conversion permit in March. It's now October and I'm still waiting. The city asked for the same drainage plan three times. Each time I had to pay my architect $500 to resubmit. No one can tell me when I'll actually get approved." %>
          <div class="help-text">Include specific details about delays, unclear requirements, conflicting information, or unexpected costs</div>
        </div>

        <div class="form-group">
          <%= form.label :timeline_impact, "How long has this delayed your project?" %>
          <%= form.select :timeline_impact,
              Report::TIMELINE_IMPACTS,
              { prompt: "Select delay timeframe" },
              { required: true } %>
        </div>
      </div>

      <!-- SECTION 2: Optional Details -->
      <div class="form-section">
        <h2 class="form-section-header">Additional Details (Optional)</h2>
        <p class="form-section-description">This helps us identify patterns across reports. Skip anything you're unsure about.</p>

        <div class="form-group">
          <label>Which issues are you experiencing? (optional)</label>
          <div class="help-text">Select any that apply. Not sure? That's okay - skip this section.</div>
          <div class="checkbox-grid">
            <% Report::ISSUE_CATEGORIES.each do |category| %>
              <div class="checkbox-item">
                <%= check_box_tag 'report[issue_categories][]', category,
                    @report.issue_categories.include?(category),
                    id: "report_issue_categories_#{category.parameterize.underscore}" %>
                <%= label_tag "report_issue_categories_#{category.parameterize.underscore}",
                    category, class: "checkbox-label" %>
              </div>
            <% end %>
          </div>
        </div>

        <div class="form-group">
          <label>Which departments are involved? (optional)</label>
          <div class="help-text">Don't know? We can figure it out from your story.</div>
          <div class="checkbox-grid">
            <% Report::DEPARTMENTS.each do |dept| %>
              <div class="checkbox-item">
                <%= check_box_tag 'report[departments][]', dept,
                    @report.departments.include?(dept),
                    id: "report_departments_#{dept.parameterize.underscore}" %>
                <%= label_tag "report_departments_#{dept.parameterize.underscore}",
                    dept, class: "checkbox-label" %>
              </div>
            <% end %>
          </div>
        </div>

        <div class="form-group">
          <%= form.label :financial_impact, "Financial impact (optional)" %>
          <%= form.text_field :financial_impact,
              placeholder: "e.g., $50,000 in extra costs, $2,000/month holding costs, lost income" %>
          <div class="help-text">Estimate additional costs beyond normal permit fees (architect fees, holding costs, lost income, etc.)</div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <%= form.submit "Submit Report", class: "btn btn-primary", data: { disable_with: "Submitting..." } %>
        <p class="privacy-note">
          Your information will be used to advocate for policy changes. All reports are anonymized when shared with officials.
        </p>
      </div>
    <% end %>
    </section>
  </main>

  <%= render "shared/footer" %>
</div>
